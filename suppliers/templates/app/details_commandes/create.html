{% extends 'app/layouts/default.html' %}
{% block content %}
{% load crispy_forms_tags %}
<!-- Begin Page Content -->
<div class="container-fluid">

    <!-- Page Heading -->
    <h1 class="h3 mb-2 text-gray-800">Orders Details</h1>

    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">New Order Details</h6>
        </div>
        <div class="card-body">
                <div class="container">
                    <form action="{% url 'details_commandes_store' %}" method="post">
                        {% csrf_token %}
                        <div class="form-group">
                            {{ form.commande|as_crispy_field }}
                        </div>
                        <div class="form-group">
                            <label>Cat√©gorie</label>
                            <select name="categorie" id="id_categorie" class="form-control">
                                <option value="">---------</option>
                                {% for categorie in categories %}
                                <option value="{{ categorie.id }}">{{ categorie.nom_categorie }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Produit</label>
                            <select name="produit" id="id_produit" class="form-control">
                                <option value="">---------</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Prix Produit</label>
                            <input type="text" name="unit_price" value="" id="unit_price" class="form-control">
                        </div>
                        <div class="form-group">
                            {{ form.quantite|as_crispy_field }}
                        </div>
                        <div class="form-group">
                            {{ form.prix_total|as_crispy_field }}
                        </div>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>

                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                    <script>
                        $(function () {
                            $("#id_categorie").on("change", function () {
                                var categorie_id = $(this).val();
                                $.get(
                                    "/get_produits_by_categorie/",
                                    {"categorie_id": categorie_id},
                                    function (data) {
                                        var options = '<option value="">---------</option>';
                                        data.forEach(function (produit) {
                                            options += '<option value="' + produit.id + '">' + produit.nom + '</option>';
                                        });
                                        $("#id_produit").html(options);
                                    }
                                );
                            });
                        });
                    </script>

                </div>
        </div>
    </div>

</div>
<!-- /.container-fluid -->
{% endblock %}
